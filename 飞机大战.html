<!doctype html>
<html>
<head>
<meta charset="utf-8">
<title>asds</title>
<style type="text/css">
            * { padding: 0px; margin: 0px; overflow: hidden; } 
            body,html { width: 100%; height: 100%; line-height: 1; font-family: "Microsoft YaHei",Arial, Helvetica, sans-serif; }
            #wrap {width: 100%;position: fixed;top: 0px;  left:0px; right: 0px; bottom: 0px; text-align: center; margin: 0 auto; background: #09F}
        </style>
</head>

<body>
<!--画布-->
<div id="wrap">
  <canvas id="mycanvas"></canvas>
</div>

<script type="text/javascript">

    var wrap = document.getElementById("wrap");
    var mycanvas = document.getElementById("mycanvas");
    mycanvas.width = wrap.offsetWidth > 800 ? 640 : wrap.offsetHeight;
    mycanvas.height = wrap.offsetHeight;
    var ctx = mycanvas.getContext("2d");//画笔
    var images = [];
    var cloudImg = null,cloudData = null,cloudObj = null;

    //加载资源
    window.onload = function(){
        var sources = {
            PaperBoy1: "https://cdn.files.qdfuns.com/article/content/picture/201808/12/192048lnxixjt90xv8k910.png",//玩家
            PaperBoy2: "https://cdn.files.qdfuns.com/article/content/picture/201808/12/192045rvl1g0d17ztlog7d.png",//敌机1
            PaperBoy3: "https://cdn.files.qdfuns.com/article/content/picture/201808/12/192046p4dybtn1dummadz3.png",//敌机2
            PaperBoy4: "https://cdn.files.qdfuns.com/article/content/picture/201808/12/192047bv4sd4y34svzyw8o.png",//敌机3
            PaperBoy5: "https://cdn.files.qdfuns.com/article/content/picture/201808/12/192054o8mpomibdjol8brm.png",//爆炸
            PaperBoy6: "https://cdn.files.qdfuns.com/article/content/picture/201808/12/192044d5oysommyj1fyrf5.jpg",//背景
            PaperBoy7: "https://cdn.files.qdfuns.com/article/content/picture/201808/12/192045o98jbz0151e5xt7j.png",//子弹
            PaperBoy8: "https://cdn.files.qdfuns.com/article/content/picture/201808/12/192048b0dnzdk5ukzhlkau.png"//云
        };
        loadImages(sources,play);
    };

    //加载图片
    function loadImages(sources,callback){
        var imagesNum = 0;//图片数量
        var imagesLoad = 0;//图片加载数量
        for(var key in sources){ imagesNum++; }
        for(key in sources){
            images[key] = new Image();//把数组当对象使用
            images[key].onload = function(){
                if(++imagesLoad >= imagesNum){
                    callback();
                }
            };
            images[key].src = sources[key];
        }
    }

    //通用构造器
    function baseConstructor(config){
        this.imgs = config.imgs;
        this.type = config.type;
        this.width = config.width;
        this.height = config.height;
        this.sum = config.sum;
        this.score = config.score;
        this.life = config.life;
        this.time = 0;//设置相对速度
        this.index = 0;//设置图片的索引值
        this.down = false;//是否执行爆破动画的标识
        this.potion = 0;
        this.canDelete = false;//是否删除标识
        this.x = 0;
        this.y = 0;
        this.paint = function() {
            ctx.drawImage(this.imgs[this.index], this.x, this.y);
        };
        this.step = function() {}
    }

    //游戏主体函数
    function play(){

        var gameData = {
            state:this.STATE,//游戏当前状态
            STATE:0, //
            STARTING: 1, //开始
            RUNNING: 2, //运行
            PAUSED: 3, //暂停
            GAMEOVER: 4, //结束
            score: 0 //得分
        };

        var set_time = null;

        //加载云
        cloudImg = images["PaperBoy8"];
        //初始化云
        cloudData = {
            imgs:cloudImg,
            width:512,
            height:768
        };
        //构造云
        function CLOUD(config){
            baseConstructor.call(this,config);
            this.y1 = -mycanvas.height;
            this.y2 = 0;
            this.draw = function(){
                ctx.drawImage(this.imgs,0,0,this.width,this.height,0,this.y1,mycanvas.width,mycanvas.height);
                ctx.drawImage(this.imgs,0,0,this.width,this.height,0,this.y2,mycanvas.width,mycanvas.height);
            };
            this.step = function(){
                this.time++;
                if(this.time++ % 5 == 0){
                    this.y1++;
                    this.y2++;
                    this.y1 >= mycanvas.height && (this.y1 = -mycanvas.height);
                    this.y2 >= mycanvas.height && (this.y2 = -mycanvas.height);
                    this.time = 0;
                }
            };
        }
        cloudObj = new CLOUD(cloudData);

        function skyBg(){
            cloudObj.step();
            cloudObj.draw();
        }

        //游戏初始化
        this.init = function() {
            gameData.state = 0; //gameData.STATE;
            gameExec();
        }

        function gameover() {
            ctx.font = "bold 45px 微软雅黑";
            clearTimeout(set_time);
        }

        //游戏执行函数
        function gameExec() {
            switch (gameData.state) {

                case gameData.STATE:
                    ctx.clearRect(0, 0, mycanvas.width, mycanvas.height);
                    skyBg();
                    break;

                case gameData.PAUSED:
                    break;

                case gameData.GAMEOVER:
                    break;

            }
            if (gameData.state != gameData.GAMEOVER) {
                set_time = setTimeout(function() {
                    gameExec();
                }, 10);
            } else {
                gameover();
            }
        }

        //开始
        this.init();
    }








</script>
</body>
</html>
